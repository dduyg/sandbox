<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LiminalüèêLoop</title>
<style>
* { box-sizing: border-box; }
:root {
  --bg: #3A3A3C;
  --main: #B8B9BE;
  --accent: #F0F0F0;
  --border: rgba(184,185,190,0.25);
  --accent-color: #AC4E5E;
}

body {
  margin: 0;
  padding: 20px;
  font-family: system-ui, sans-serif;
  background-color: var(--bg);
  color: var(--main);
  min-height: 100vh;
  overflow-x: hidden;
}

/* ===== Header ===== */
h1 {
  margin-bottom: 16px;
  font-weight: 500;
  color: var(--accent);
}

/* ===== Controls ===== */
.controls {
  display: flex;
  align-items: stretch;
  gap: 8px;
  margin-bottom: 14px;
  flex-wrap: wrap;
  max-width: 900px;
}

/* Toggle Button */
.toggleBtn {
  position: relative;
  width: 70px;
  height: 42px;
  background: #2f2f31;
  border: 1px solid var(--border);
  border-radius: 2px;
  cursor: pointer;
  user-select: none;
  transition: background 0.15s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.toggleBtn:hover {
  background: rgba(255,255,255,0.08);
}

.toggle-switch {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 8px;
}

.toggle-icon {
  width: 18px;
  height: 18px;
  z-index: 1;
  transition: opacity 0.3s ease;
  pointer-events: none;
  display: flex;
  align-items: center;
  justify-content: center;
}

.toggle-icon svg {
  width: 100%;
  height: 100%;
  fill: rgba(240,240,240,0.4);
  transition: fill 0.3s ease;
}

.toggle-icon.active svg {
  fill: #fff;
}

.toggle-slider {
  position: absolute;
  top: 4px;
  left: 4px;
  width: calc(50% - 4px);
  height: calc(100% - 8px);
  background: var(--accent-color);
  transition: transform 0.3s ease;
  border-radius: 1px;
}

.toggle-switch.and-mode .toggle-slider {
  transform: translateX(calc(100% + 4px));
}

/* Custom Dropdown Styling */
.dropdown-container {
  position: relative;
  flex: 1;
  min-width: 200px;
  max-width: 400px;
  text-align: left;
}

.dropdown-search {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--border);
  background: #2f2f31;
  color: var(--accent);
  font-family: inherit;
  font-size: 14px;
  outline: none;
  border-radius: 2px;
  height: 42px;
}

.dropdown-search::placeholder {
  color: rgba(240,240,240,0.5);
}

.dropdown-list {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: #2f2f31;
  border: 1px solid var(--border);
  border-top: none;
  max-height: 250px;
  overflow-y: auto;
  display: none;
  box-shadow: 0 6px 16px rgba(0,0,0,0.35);
  z-index: 1000;
  border-radius: 0 0 2px 2px;
}

.dropdown-list.show {
  display: block;
}

.dropdown-item {
  padding: 10px 12px;
  cursor: pointer;
  color: var(--main);
  transition: background 0.15s ease;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.dropdown-item:hover {
  background: rgba(255,255,255,0.08);
}

.dropdown-item.selected {
  background: var(--accent-color);
  color: #fff;
  font-weight: 500;
}

.dropdown-item.selected .tag-count {
  color: rgba(255,255,255,0.9);
}

.tag-count {
  font-size: 12px;
  color: rgba(184,185,190,0.6);
  font-weight: normal;
  margin-left: 8px;
}

/* Favorites Toggle */
.favToggle {
  height: 42px;
  padding: 0 16px;
  font-size: 16px;
  cursor: pointer;
  background: #2f2f31;
  border: 1px solid var(--border);
  color: var(--main);
  border-radius: 2px;
  transition: background 0.15s ease, color 0.15s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.favToggle:hover {
  background: rgba(255,255,255,0.08);
  color: var(--accent);
}

.favToggle.active {
  background: var(--accent-color);
  color: #fff;
  border-color: var(--accent-color);
}

.favToggle svg {
  width: 20px;
  height: 20px;
  fill: currentColor;
}

/* ===== Grid ===== */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 16px;
  max-width: 900px;
  margin: 0 auto;
}

@media (max-width: 400px) {
  .grid {
    grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
  }
}

/* ===== Item ===== */
.item {
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.04);
  border-radius: 2px;
  padding: 12px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  aspect-ratio: 1 / 1;
  transition: box-shadow 0.15s ease, transform 0.15s ease;
  position: relative;
}

.item:hover {
  box-shadow: 0 6px 16px rgba(0,0,0,0.35);
}

.item svg {
  width: 100%;
  height: 100%;
  max-height: 64px;
  fill: var(--main);
  transition: fill 0.2s ease, transform 0.2s ease;
}

.item:hover svg {
  fill: var(--accent-color);
  transform: scale(1.08);
}

/* ===== Actions ===== */
.actions {
  display: flex;
  justify-content: flex-end;
  gap: 6px;
  margin-top: 6px;
}

.actions button {
  background: transparent;
  border: none;
  color: var(--main);
  cursor: pointer;
  padding: 2px;
  font-size: 14px;
  transition: color 0.15s ease;
}

.actions button:hover {
  color: var(--accent);
}

/* ===== Tag Panel Popup ===== */
.tag-panel {
  position: absolute;
  bottom: 100%;
  right: 0;
  background: #2f2f31;
  border: 1px solid var(--border);
  border-radius: 2px;
  padding: 10px 12px;
  margin-bottom: 8px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.35);
  z-index: 100;
  min-width: 150px;
  display: none;
}

.tag-panel.show {
  display: block;
}

.tag-panel::after {
  content: '';
  position: absolute;
  top: 100%;
  right: 12px;
  border: 6px solid transparent;
  border-top-color: #2f2f31;
}

.tag-panel-title {
  font-size: 11px;
  text-transform: uppercase;
  color: rgba(184,185,190,0.6);
  margin-bottom: 6px;
  font-weight: 500;
}

.tag-panel-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.tag-panel-tag {
  font-size: 12px;
  padding: 3px 8px;
  background: rgba(172,78,94,0.2);
  color: var(--accent);
  border-radius: 1px;
  border: 1px solid rgba(172,78,94,0.3);
}

/* Smaller actions on small screens */
@media (max-width: 480px) {
  .actions button {
    font-size: 12px;
  }
}
</style>
</head>
<body>
<h1>SVG Catalog</h1>

<div class="controls">
  <div class="toggleBtn" onclick="toggleMode()">
    <div class="toggle-switch">
      <span class="toggle-icon or-icon active">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 600"><path d="m282.8 172.7-.3 34.8-9.5.5c-5.2.3-10.1.9-10.7 1.3-.9.6-1.3 3.9-1.3 10.6 0 6.9-.4 10.2-1.3 10.9-.7.6-6.2 1.3-12.3 1.4l-10.9.3-.3 10.5c-.1 5.8-.6 10.8-1.1 11.3-.4.4-4.8.9-9.8 1.1-4.9.1-9.4.6-10.1 1q-1.2.75-1.2 10.5c0 6.9-.4 10.2-1.3 10.9-.7.6-6.2 1.3-12.3 1.4l-10.9.3-.3 10.4c-.1 5.8-.7 11-1.3 11.7-.6.8-4.1 1.2-9.8 1.1-4.8 0-9.3.3-9.9.7-.8.5-1.2 4.1-1.2 10.6 0 6.8-.4 10.1-1.2 10.7-.7.4-6.2 1-12.3 1.3l-11 .5-.3 10.5c-.1 5.8-.7 10.9-1.3 11.5-.5.5-5 1.1-9.9 1.1-4.8.1-9.3.5-9.9.8-.7.5-1.1 4.5-1.1 10.5 0 6.2-.4 10.1-1.2 10.9s-5 1.2-12.5 1.2H95v90h47v-32.5c0-31 .1-32.5 1.9-33.5 1.1-.5 6.3-1 11.5-1 11.2 0 10.5.9 10.9-13.5l.2-9 11-.5 11-.5.3-10.8c.3-10.5.3-10.8 2.8-11.7 1.4-.6 6.5-1 11.4-1 10.5 0 9.9.8 10.3-13.5l.2-9 11-.5 11-.5.3-10.5c.2-8.4.6-10.7 1.9-11.8 1.1-.8 5.2-1.2 11.5-1.2 11.4 0 10.6.9 11.1-13.5l.2-9 11-.5 11-.5.3-10.5c.1-5.8.7-10.9 1.3-11.5.5-.5 5.8-1.2 11.7-1.5l10.7-.5.5-11 .5-11 11-.5 11-.5.3-46.8.2-46.7h-47zm178.5-32c-1 .4-1.3 8-1.3 33.4 0 20.9-.4 33.7-1 35-.9 1.7-2.2 1.9-10.4 1.9-6.5 0-9.7.4-10.4 1.3-.6.7-1.3 5.8-1.4 11.3l-.3 9.9-11.5.6c-6.3.4-11.6.7-11.7.8-.2 0-.3 4.1-.3 9s-.4 10.1-1 11.5c-.9 2.5-1.2 2.6-10.4 2.6-6.5 0-9.7.4-10.4 1.3-.6.7-1.3 5.8-1.4 11.3l-.3 9.9-11.5.6c-6.3.4-11.6.7-11.7.8-.2 0-.3 4.1-.3 9s-.4 10.1-1 11.5c-.9 2.5-1.2 2.6-10.4 2.6-6.5 0-9.7.4-10.4 1.3-.6.7-1.3 5.8-1.4 11.3l-.3 9.9-11.5.6c-6.3.4-11.6.7-11.7.8-.2 0-.3 4.1-.3 9s-.4 10.1-1 11.5c-.9 2.5-1.2 2.6-10.4 2.6-6.5 0-9.7.4-10.4 1.3-.6.7-1.3 5.8-1.4 11.3l-.3 9.9-11.5.6c-6.3.4-11.8.7-12.2.8-.5 0-.8 20.4-.8 45.1v45l23.8-.2 23.7-.3.5-33 .5-33 9-.2c14.5-.5 13.5.4 13.5-11.8 0-7.2.4-10.6 1.3-11.2.6-.4 5.9-1 11.7-1.3l10.5-.5.5-11 .5-11 9-.2c14.5-.5 13.5.4 13.5-11.8 0-7.2.4-10.6 1.3-11.2.6-.4 5.9-1 11.7-1.3l10.5-.5.5-11 .5-11 9-.2c14.5-.5 13.5.4 13.5-11.8 0-7.2.4-10.6 1.3-11.2.6-.4 5.9-1 11.7-1.3l10.5-.5.5-11 .5-11 9-.2c14.5-.5 13.5.4 13.5-11.8 0-10.4 0-10.6 2.6-11.5 1.4-.6 6.6-1 11.5-1h8.9v-94l-21.7.1c-12 0-22.4.3-23 .6"/></svg>
      </span>
      <div class="toggle-slider"></div>
      <span class="toggle-icon and-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 600"><path d="M309.8 99.8c-8.9 5.8-18.4 11.9-21.6 13.7-.9.5-4.4 2.7-7.7 4.9-10.8 7-15.9 10.2-22.2 14.2-11 6.9-31.3 19.8-38 24.1-3.5 2.4-6.6 4.3-6.8 4.3-.3 0-3 1.7-6.2 3.9-3.2 2.1-8.3 5.4-11.3 7.3-24.3 15.3-23 13.6-17.5 22.3 1.8 2.7 4.3 6.8 5.6 9s2.9 4.6 3.6 5.3 1.3 1.7 1.3 2.2 1.7 3.5 3.9 6.7c3.4 5.1 23.3 36.6 26.4 41.8.6 1.1 2.8 4.6 4.9 7.8s3.8 6.1 3.8 6.5c0 .5 1.1 2.3 2.5 4.2 2.5 3.3 3.4 8 1.6 8-.5 0-1.6.6-2.3 1.2-1.9 1.8-9.3 6.8-10.1 6.8-.3 0-3.2 1.7-6.4 3.8-3.2 2.2-8.9 5.8-12.8 8.2-12.5 7.7-17.9 11.2-23.8 15.1-3.2 2.2-6.1 3.9-6.5 3.9s-3.3 1.8-6.5 4c-3.1 2.2-6.1 4-6.6 4s-1.6.6-2.3 1.3c-1.1 1.1-5.8 4.2-11 7.2-9.6 5.6-14.8 9.3-15.2 10.9-.3 1.2.7 3.7 2.4 6.3 1.7 2.4 3 4.7 3 5.1s1.6 3.2 3.6 6.2 4 6.4 4.5 7.5 2.3 4 3.9 6.5 3.6 5.8 4.5 7.5c.8 1.6 2.4 4.3 3.5 6 1.1 1.6 2.7 4.4 3.7 6.2s6.3 10.7 11.8 19.8 10.9 18.1 12 20 4.9 8.3 8.5 14.2c3.5 6 6.9 11.7 7.6 12.8.6 1.1 3.7 6.3 6.9 11.5 10.3 16.9 12.5 20.8 12.5 21.9 0 1.2 5.6 1.5 6.2.3.5-1.1 7.5-6.2 8.6-6.2.4 0 3.1-1.7 6-3.8 2.8-2 7.6-5.3 10.7-7.2 13.2-8.3 25.6-16.6 43.4-29.1 5.5-3.8 21-16.3 27.1-21.8 2.5-2.3 4.9-4.1 5.5-4.1 1.3 0 4.4 3.9 9 11.5 2.2 3.7 5.5 9 7.3 11.8 1.8 2.9 5.1 8.3 7.5 12.1 2.3 3.7 6.1 9.7 8.5 13.3 2.3 3.5 4.2 6.8 4.2 7.1 0 .4 1.8 3.3 4 6.4 2.2 3.2 4.2 6.8 4.6 8.2.4 1.8 1.5 2.6 4 3.1 1.9.3 4.3.4 5.2.1 1.6-.6 4.7-4.8 6.5-9.1.4-1.1 1.4-2.6 2.2-3.5.7-.8 2.6-4 4.3-7 1.6-3 7.5-13.2 13-22.5 5.5-9.4 15.2-25.7 21.4-36.3s12.2-20.8 13.3-22.7c1.1-1.8 4.6-7.9 7.8-13.4 3.2-5.6 6.2-10.1 6.8-10.1.5 0 .9-2 .9-4.5 0-3-.4-4.5-1.3-4.5-1.9 0-5.7 2.9-5.7 4.4 0 .7-.9 2.4-1.9 3.8-1.1 1.3-3.3 5.1-5.1 8.3-1.7 3.3-5.1 9.6-7.6 14-2.4 4.4-4.7 8.7-5.1 9.5-1.5 3.5-9.5 11.8-11.9 12.4-4.6 1.2-6.4-.8-20.2-22.4-6.6-10.2-8.7-13.5-9.5-14.5-.4-.6-3.7-5.5-7.2-11-6.8-10.4-6.8-10.4-4-17.5 3.3-8.6 6.9-21 8.9-30.5 1-4.9 1.6-6 3.6-6.6 1.4-.4 16.1-.7 32.7-.8l30.3-.1.5-2.3c.9-3.4.1-68-.8-69.5-.6-.9-8.7-1.2-34.7-1.2-29.9 0-33.9.2-34.4 1.6-.3.9-.6 14.2-.6 29.7-.1 15.5-.5 30.2-1.1 32.7-.5 2.5-1.6 8.3-2.4 13-1.3 7.9-3.5 15-8 25.8-1.7 4.2-1.8 4.2-3.7 2.5-1.8-1.5-10.3-13.8-11.8-16.8-.3-.6-2.3-3.7-4.4-7-4.1-6.3-13-20.1-17.4-27-4.6-7.3-7.7-12-8.5-13-1.5-2-5.7-8.6-5.7-9 0-.2-2.4-3.9-5.3-8.2s-6.8-10.5-8.7-13.7l-3.3-5.9 3.4-2.8c1.9-1.6 3.8-2.9 4.2-2.9s3.5-1.8 6.8-4 6.2-4 6.5-4c.2 0 3-1.8 6.1-4 3.2-2.2 6.1-4 6.5-4s3.3-1.7 6.5-3.9c3.2-2.1 9.6-6.2 14.3-9.1 14.1-8.7 15.3-9.4 21.7-13.7 3.4-2.3 7.1-4.4 8.2-4.8 4.6-1.4 3.3-6.7-4.3-17.2-1.7-2.3-4.4-6.4-6-9s-6.6-10.4-11.1-17.3-8.8-13.6-9.5-15-2.6-4.3-4.2-6.5c-3.8-5.3-11.3-16.7-12.1-18.6-.3-.8-3.7-5.9-7.4-11.4-5.3-7.8-7.4-10.1-9.3-10.2-1.6-.2-5.5 1.7-11.2 5.5m-29.8 43c1.7 2.4 3 4.5 3 4.8s1.7 3.1 3.8 6.2c7.6 11.3 12.2 18.3 12.2 18.7 0 .2 3.3 5.3 7.3 11.2 4 6 7.6 11.6 8 12.6.3.9 2 3.6 3.7 6 5.3 7.2 12 17.9 12 19.2 0 1.8-11.1 10.5-13.3 10.5-.4 0-2.9 1.5-5.5 3.2-10.8 7.4-13.8 8.9-15.7 8.2-.8-.4-4.4-5-7.9-10.3-8.2-12.5-12-18.4-12.6-19.6-.3-.6-3.6-5.7-7.4-11.5s-9.2-14.1-12.1-18.5c-2.8-4.4-7.3-11.2-9.8-15.2-5.1-7.8-7-12-6.2-13.3.3-.5 2.9-2.3 5.8-4 2.8-1.7 7.2-4.4 9.7-6s7.7-4.7 11.5-6.9l7-4.1 1.8 2.3c.9 1.2 3.1 4.1 4.7 6.5m-35.5 156.9c10.9 17 15.5 24.3 15.5 24.8 0 .3 1.8 3.1 4 6.2 2.2 3.2 4 6.1 4 6.6 0 .4 1.6 3 3.5 5.7s3.5 5.4 3.5 5.8c0 .5 1.5 2.9 3.3 5.3 1.9 2.4 4 5.6 4.8 7.1 1.3 2.5 5.6 9.4 17.6 28.6 2.3 3.7 4.8 7.8 5.5 9.2s3.7 6.1 6.6 10.4c2.8 4.4 5.2 9 5.2 10.2 0 2.5-8 10.6-20.5 20.6-13.3 10.7-16.5 12.8-18.5 12-1.5-.6-11-13.3-11-14.8 0-.2-3.5-5.7-7.7-12.2-4.3-6.4-8.1-12.5-8.5-13.4s-2.2-3.8-4.1-6.5c-1.8-2.6-3.6-5.3-3.8-5.8-.4-1.1-6.1-9.8-12.1-18.7-2.1-3.1-3.8-5.8-3.8-6.1s-2.4-4.1-5.2-8.5c-11.8-18-17.4-26.8-18.3-28.7-.6-1.1-3.2-5.2-5.8-9.2-2.6-3.9-4.7-7.8-4.7-8.6 0-1.4 6.2-5.8 21.2-15.1 3.5-2.2 8.6-5.4 11.3-7.1 5.5-3.6 10.6-6.4 11.7-6.5.4 0 3.2 3.9 6.3 8.7"/></svg>
      </span>
    </div>
  </div>
  
  <div class="dropdown-container">
    <input type="text" class="dropdown-search" placeholder="Search to filter by tags..." />
    <div id="tagList" class="dropdown-list"></div>
  </div>

  <button id="favToggle" class="favToggle">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g stroke-linecap="round" stroke-linejoin="round"/><path d="m12.672 2.76 2.581 5.239h-.015l.002.003h6.008a.75.75 0 0 1 .743.648l.007.102a.75.75 0 0 1-.648.743l-.102.007h-6.48a.75.75 0 0 1-.623-.332l-.053-.093-.798-1.659L12 4.788 9.814 9.225a.75.75 0 0 1-.566.411l-4.895.707 3.545 3.45a.75.75 0 0 1 .216.665l-.84 4.873 4.339-2.286a2.25 2.25 0 0 0 .093 1.647l-5.08 2.676a.75.75 0 0 1-1.089-.79l1.031-5.986-4.352-4.236a.75.75 0 01 .416-1.28l6.01-.868 2.684-5.448a.75.75 0 0 1 1.346 0M21.25 17a.75.75 0 0 1 .102 1.493l-.102.007h-7.5a.75.75 0 0 1-.102-1.493L13.75 17zm-.002-4.49a.75.75 0 0 1 .102 1.492l-.102.007h-7.5a.75.75 0 0 1-.102-1.493l.102-.007z"/></svg>
  </button>
</div>

<div class="grid" id="gallery"></div>

<script>
let svgs = [];
let selectedTags = [];
let tagMode = 'OR';
let favoritesOnly = false;

const gallery = document.getElementById('gallery');
const tagList = document.getElementById('tagList');
const dropdownSearch = document.querySelector('.dropdown-search');
const favToggle = document.getElementById('favToggle');

const FAVORITES_KEY = 'svg-favorites';

// Load JSON
fetch('https://cdn.jsdelivr.net/gh/dduyg/LiminalLoop@main/catalog.svgs.json')
  .then(res => res.json())
  .then(data => {
    svgs = data;
    generateTagList();
    renderSVGs();
  });

function getFavorites() {
  return new Set(JSON.parse(localStorage.getItem(FAVORITES_KEY) || '[]'));
}

function toggleFavorite(id) {
  const favs = getFavorites();
  favs.has(id) ? favs.delete(id) : favs.add(id);
  localStorage.setItem(FAVORITES_KEY, JSON.stringify([...favs]));
  renderSVGs();
}

function matchesTags(svg) {
  if (selectedTags.length === 0) return true;
  return tagMode === 'AND'
    ? selectedTags.every(t => svg.tags.includes(t))
    : selectedTags.some(t => svg.tags.includes(t));
}

function showTagPanel(event, tags) {
  event.stopPropagation();
  
  // Close any open panels
  document.querySelectorAll('.tag-panel').forEach(panel => {
    panel.classList.remove('show');
  });
  
  // Find the panel in this item
  const button = event.currentTarget;
  const item = button.closest('.item');
  const panel = item.querySelector('.tag-panel');
  
  panel.classList.add('show');
  
  // Close panel when clicking outside
  setTimeout(() => {
    const closePanel = (e) => {
      if (!panel.contains(e.target) && e.target !== button) {
        panel.classList.remove('show');
        document.removeEventListener('click', closePanel);
      }
    };
    document.addEventListener('click', closePanel);
  }, 0);
}

function renderSVGs() {
  const favs = getFavorites();
  gallery.innerHTML = '';

  svgs
    .filter(svg => {
      if (favoritesOnly && !favs.has(svg.id)) return false;
      if (!matchesTags(svg)) return false;
      return true;
    })
    .forEach(svg => {
      const div = document.createElement('div');
      div.className = 'item';
      
      const tagsHTML = svg.tags.map(tag => 
        `<span class="tag-panel-tag">${tag}</span>`
      ).join('');
      
      div.innerHTML = `
        <svg viewBox="${svg.viewBox}" xmlns="http://www.w3.org/2000/svg">
          ${svg.svg}
        </svg>
        <div class="actions">
          <button onclick="showTagPanel(event, ${JSON.stringify(svg.tags).replace(/"/g, '&quot;')})">Íí∞ Íí±</button>
          <button onclick='copySVG(${JSON.stringify(svg)})'>‚øª</button>
          <button onclick="toggleFavorite('${svg.id}')">
            ${favs.has(svg.id) ? '‚òÖ' : '‚òÜ'}
          </button>
        </div>
        <div class="tag-panel">
          <div class="tag-panel-title">Tags</div>
          <div class="tag-panel-tags">
            ${tagsHTML}
          </div>
        </div>
      `;
      gallery.appendChild(div);
    });
  
  updateTagCounts();
}

function getTagCounts() {
  const tagCounts = {};
  
  svgs.forEach(svg => {
    svg.tags.forEach(tag => {
      tagCounts[tag] = (tagCounts[tag] || 0) + 1;
    });
  });
  
  return tagCounts;
}

function updateTagCounts() {
  const tagCounts = getTagCounts();
  const items = tagList.querySelectorAll('.dropdown-item');
  
  items.forEach(item => {
    const tagName = item.querySelector('.tag-name').textContent;
    const countSpan = item.querySelector('.tag-count');
    const count = tagCounts[tagName] || 0;
    countSpan.textContent = `(${count})`;
  });
}

function generateTagList() {
  const tagCounts = getTagCounts();
  const sortedTags = Object.keys(tagCounts).sort();

  tagList.innerHTML = '';
  
  sortedTags.forEach(tag => {
    const div = document.createElement('div');
    div.className = 'dropdown-item';
    
    const tagName = document.createElement('span');
    tagName.className = 'tag-name';
    tagName.textContent = tag;
    
    const tagCount = document.createElement('span');
    tagCount.className = 'tag-count';
    tagCount.textContent = `(${tagCounts[tag]})`;
    
    div.appendChild(tagName);
    div.appendChild(tagCount);
    
    div.onclick = () => toggleTag(tag);
    tagList.appendChild(div);
  });
}

function showDropdown() {
  tagList.classList.add('show');
}

function filterDropdown() {
  const input = dropdownSearch.value.toLowerCase();
  const items = tagList.querySelectorAll('.dropdown-item');
  
  items.forEach(item => {
    const text = item.querySelector('.tag-name').textContent.toLowerCase();
    item.style.display = text.includes(input) ? 'flex' : 'none';
  });
}

function toggleTag(tag) {
  const index = selectedTags.indexOf(tag);
  const items = tagList.querySelectorAll('.dropdown-item');
  
  if (index > -1) {
    selectedTags.splice(index, 1);
  } else {
    selectedTags.push(tag);
  }

  items.forEach(item => {
    const tagName = item.querySelector('.tag-name').textContent;
    if (tagName === tag) {
      item.classList.toggle('selected');
    }
  });

  dropdownSearch.placeholder = selectedTags.length > 0 
    ? selectedTags.join(', ') 
    : "Search to filter by tags...";
  
  renderSVGs();
}

function toggleMode() {
  const toggleSwitch = document.querySelector('.toggle-switch');
  const orIcon = document.querySelector('.or-icon');
  const andIcon = document.querySelector('.and-icon');
  
  tagMode = tagMode === 'OR' ? 'AND' : 'OR';
  toggleSwitch.classList.toggle('and-mode');
  
  // Toggle active state on icons
  orIcon.classList.toggle('active');
  andIcon.classList.toggle('active');
  
  renderSVGs();
}

function copySVG(svg) {
  const code = `<svg viewBox="${svg.viewBox}" xmlns="http://www.w3.org/2000/svg">${svg.svg}</svg>`;
  navigator.clipboard.writeText(code);
}

// Event listeners
dropdownSearch.addEventListener('focus', showDropdown);
dropdownSearch.addEventListener('input', filterDropdown);

window.onclick = function(event) {
  if (!event.target.matches('.dropdown-search')) {
    tagList.classList.remove('show');
  }
};

favToggle.onclick = () => {
  favoritesOnly = !favoritesOnly;
  favToggle.classList.toggle('active', favoritesOnly);
  renderSVGs();
};
</script>
</body>
</html>
